<!DOCTYPE html>
<html lang="en">
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk Page</title>
</head>
<body>
<h1>Walking Test</h1>
<button id="startWalking">Start Walking</button>
<button id="stopWalking">Stop Walking</button>
<button id="poop">Poop</button>
<button id="pee">Pee</button>
<button id="water">Water</button>
<script>
    let walkingInterval
    let currentLocation = {latitude: null, longitude: null}
    let walkId = null

    // 산책 시작 버튼
    document.getElementById('startWalking').addEventListener('click', () => {
        if (!walkingInterval) {
            // 서버에 산책 시작 요청
            fetch('http://localhost:8080/api/v1/walks', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    timestamp: new Date()
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('산책 시작:', data)
                    // 서버로부터 받은 산책 ID 저장
                    // walkId = data.walkId
                    walkingInterval = setInterval(() => updateLocation(walkId), 3000)
                })
                .catch((error) => console.error('Error:', error));
        }
    })
    // 산책 중지 버튼
    document.getElementById('stopWalking').addEventListener('click', () => {
        if (walkingInterval) {
            clearInterval(walkingInterval);
            walkingInterval = null
            console.log('산책 종료')
        }
    })

    // 활동 전송 버튼 - 대변
    document.getElementById('poop').addEventListener('click', () => {
        if (walkingInterval) {
            sendActivity('POOP',1)
            console.log('poop')
        }
    })
    // 활동 전송 버튼 - 소변
    document.getElementById('pee').addEventListener('click', () => {
        if (walkingInterval) {
            sendActivity('PEE',1)
            console.log('pee')
        }
    })
    // 활동 전송 버튼 - 수분 섭취
    document.getElementById('water').addEventListener('click', () => {
        if (walkingInterval) {
            sendActivity('WATER',1)
            console.log('water')
        }
    })

    // 위치 정보 갱신 메서드
    function updateLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                currentLocation.latitude = position.coords.latitude
                currentLocation.longitude = position.coords.longitude
                console.log('위치 업데이트:', currentLocation)
            }, (error) => {
                console.error('Error getting location:', error)
            })
        } else {
            console.error('현재 브라우저는 지원하지 않습니다.')
        }
    }

    // 산책 활동 전송 메서드
    function sendActivity(activity, walkId) {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                const latitude = position.coords.latitude
                const longitude = position.coords.longitude
                // 서버로 위치 정보 전송
                fetch(`http://localhost:8080/api/v1/walks/${walkId}/activities`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        latitude: latitude,
                        longitude: longitude,
                        activity: activity,
                        timestamp: new Date()
                    }),
                })
                    .then(response => response.json())
                    .then(data => console.log('Success:', data))
                    .catch((error) => console.error('Error:', error))
            }, (error) => {
                console.error('Error getting location:', error)
            })
        } else {
            console.error('현재 브라우저는 지원하지 않습니다.')
        }
    }
</script>
</body>
</html>